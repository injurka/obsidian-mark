### Назначение ssh_config

В ежедневной работе системного администратора использование ssh-клиента (OpenSSH client) — обычная практика. Однако, прописывание длинных и сложных команд по конфигурированию параметров SSH вручную, в командной строке в терминале, отнимает у специалиста много лишнего времени. Начинающие администраторы, инженеры и пользователи Linux возможно не знакомы с таким простым и удобным способом настройки параметров SSH, как использование файла ssh_config.

В каких же случаях вам необходим ssh config? Представьте себе ситуацию, когда ваша задача — ежедневное подключение к нескольким удаленным серверам, причем с различными настройками (IP-адресом, логином и паролем, номерами портов и другими параметрами командной строки). Согласитесь, что вводить каждый раз все эти данные вручную — это нерациональная трата рабочего времени. Как же решить такую проблему? Одно из возможных решений — создание ssh bash alias (псевдонима) для каждого соединения с удаленным сервером. Однако, можно предложить более оптимальный вариант — создать файл конфигурации для каждого пользователя, в котором будут храниться различные параметры SSH для каждого удаленного хоста, к которому вы будете подключаться.

### Принцип работы ssh_config

Параметры конфигурации SSH соединения можно прописать с помощью трех указанных ниже способов:
1. в опциях, задаваемых с помощью командной строки;
2. в настройках файла конфигурации конкретного пользователя _~/.ssh/config_;
3. в общесистемном конфигурационном файле (для всех пользователей данного локального компьютера) _/etc/ssh/config_;
> _Примечание: наибольший приоритет имеет командная строка, затем идет ~/.ssh/ssh_config и в последнюю очередь уже /etc/ssh/ssh_config._

Пример реализации 2 и 3 ситуации:
```bash
cd ~/.ssh

ssh-keygen -t rsa
ssh-keygen -t ed25519 -C "ivan.kornilov@nordclan.com" -f "prosebya"

ssh-add id_rsa
ssh-add prosebya

touch config
```

```yaml
# Personal account, - the default config
Host github.com
   HostName github.com
   User git
   IdentityFile ~/.ssh/id_rsa
   
# Work account-1
Host gitlab.com 
   HostName gitlab.com
   User git
   IdentityFile ~/.ssh/prosebya
```
_Где: 
	Host — это alias (псевдоним) для нашего SSH-соединения
	HostName — IP адрес VPS (или имя хоста, если включен DNS)
	Port — номер порта, User — имя пользователя._

Этот скрипт генерирует новые SSH-ключи, добавляет их в агент аутентификации SSH и настраивает файл `config` для удобной работы с репозиториями на GitHub и GitLab, используя разные ключи для разных аккаунтов.

### Параметры ssh_config
- **Host** — alias (псевдоним), произвольное наименование хоста.
- **HostName** — IP адрес удаленного сервера или имя хоста (если настроен DNS).
- **Port** — номер порта (если он нестандартный, по умолчанию используется порт 22).
- **User** — имя пользователя.
- **IdentityFile** — указывается путь к SSH-ключу, который используется для аутентификации при соединении с удаленным сервером (как правило, применяется в том случае, когда ключи не хранятся в директории «по умолчанию»).
- **IdentitiesOnly** — сообщает клиенту SSH, какой именно ключ следует использовать для аутентификации на сервере (а не любые ключи, которые находятся в папке для ключей «по умолчанию»). В некоторых случаях может использоваться вместе с параметром **IdentityFile**, если этот параметр прописан в файле ssh_config, то будут проверены все ключи, даже те, которые пользователь введет в командной строке.
- **ServerAliveInterval** и **ServerAliveCountMax** — ssh-клиент будет запрашивать ответ от удаленного хоста, даже если он не получает никаких данных в указанный интервал времени. Эти параметры помогут предотвратить сбрасывание соединения по причине отсутствия активности.
- **CertificateFile** — используется опционально, совместно с параметром IdentityFile для точного указания сертификата, который необходимо предоставить для аутентификации.
- **PreferredAuthentications** — параметр, который устанавливает в каком порядке будут использоваться методы аутентификации (по умолчанию: gssapi-with-mic, hostbased аутентификация, аутентификация на базе SSH-ключей, keyboard-interactive и вход по паролю).
- **SetEnv** и **SendEnv** — эти параметры разрешают ssh-клиенту передавать локальные переменные среды на указанный удаленный хост, при этом сервер должен быть настроен для приема этих переменных. Для этого системный администратор должен на удаленном сервере в файле /etc/ssh/sshd_config установить значение Yes для параметра AcceptEnv.
- **HostKeyAlias** — клиенту SSH дается указание использовать псевдоним ключа (key alias) из файла _~/.ssh/known_hosts_ вместо HostName. Данный параметр будет полезен для хостов с динамическими IP-адресами.
- **ProxyJump** — с помощью этой опции можно организовать SSH Jump Server (jump host или bastion host), используя флаг –J при написании команды.
- **ForwardAgent** и **AddKeysToAgent** — эта опция служит для организации безопасного проброса ключа (agent forwarding), позволяет осуществить доступ удаленного хоста к локальному SSH-агенту пользователя.

### ssh-copy-id


## Источники
- #### [ssh-academy](https://www.ssh.com/academy/ssh/sshd_config)