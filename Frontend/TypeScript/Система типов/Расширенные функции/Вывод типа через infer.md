`infer` — это ключевое слово в TypeScript, которое позволяет TypeScript автоматически определять (или "выводить") тип переменной на основе её значения. Это одна из мощных возможностей TypeScript, которая помогает писать более лаконичный и безопасный код, минимизируя необходимость явного указания типов.

## Как работает `infer`?

`infer` используется в контексте условных типов (conditional types) и позволяет TypeScript "вывести" тип внутри конструкции. Оно работает только внутри условных типов и помогает извлекать типы из других типов.

### Пример 1: Вывод типа из промиса

Допустим, у нас есть тип `Promise<T>`, и мы хотим извлечь тип `T` из него. Мы можем использовать `infer` для этого:

```typescript
type UnwrapPromise<T> = T extends Promise<infer U> ? U : T;

// Пример использования
type Result = UnwrapPromise<Promise<string>>; // Result будет string
```

Здесь:
- `T extends Promise<infer U>` проверяет, является ли `T` промисом.
- Если это так, TypeScript "выводит" тип `U` (то, что находится внутри промиса) и возвращает его.
- Если `T` не является промисом, возвращается сам `T`.

### Пример 2: Вывод типа из массива

Мы можем использовать `infer` для извлечения типа элементов массива:

```typescript
type UnwrapArray<T> = T extends (infer U)[] ? U : T;

// Пример использования
type ElementType = UnwrapArray<number[]>; // ElementType будет number
```

Здесь:
- `T extends (infer U)[]` проверяет, является ли `T` массивом.
- Если это так, TypeScript выводит тип `U` (тип элементов массива) и возвращает его.
- Если `T` не является массивом, возвращается сам `T`.

### Пример 3: Вывод типа из функции

`infer` также можно использовать для извлечения типа возвращаемого значения функции:

```typescript
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : never;

// Пример использования
function foo() {
  return 42;
}

type FooReturnType = ReturnType<typeof foo>; // FooReturnType будет number
```

Здесь:
- `T extends (...args: any[]) => infer R` проверяет, является ли `T` функцией.
- Если это так, TypeScript выводит тип возвращаемого значения `R` и возвращает его.
- Если `T` не является функцией, возвращается `never`.

### Пример 4: Вывод типа параметров функции

Мы можем использовать `infer` для извлечения типов параметров функции:

```typescript
type Parameters<T> = T extends (...args: infer P) => any ? P : never;

// Пример использования
function bar(a: string, b: number) {
  return a + b;
}

type BarParameters = Parameters<typeof bar>; // BarParameters будет [string, number]
```

Здесь:
- `T extends (...args: infer P) => any` проверяет, является ли `T` функцией.
- Если это так, TypeScript выводит тип параметров `P` и возвращает его в виде кортежа.
- Если `T` не является функцией, возвращается `never`.

## Когда использовать `infer`?

`infer` полезен, когда вам нужно работать с типами, которые зависят от других типов, и вы хотите, чтобы TypeScript автоматически выводил эти типы. Это особенно полезно в библиотеках и утилитах, где типы могут быть сложными и вложенными.

### Ограничения `infer`

- `infer` работает только внутри условных типов.
- TypeScript может вывести только один тип за раз для каждого `infer`. Если нужно вывести несколько типов, потребуется несколько `infer`.