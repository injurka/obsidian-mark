Авторизация `Digest` — это один из методов аутентификации, используемый для проверки подлинности пользователя при доступе к защищенным ресурсам на сервере. Предназначен для делегирования доступа, `Digest` авторизация фокусируется на безопасной передаче учетных данных (логина и пароля) между клиентом и сервером. Этот метод является более безопасной альтернативой базовой авторизации (Basic Auth), так как он не передает пароль в открытом виде.

## Основные принципы Digest авторизации

1. **Безопасность передачи данных**: В отличие от Basic Auth, где пароль передается в открытом виде (в кодировке Base64), Digest Auth использует хэширование для передачи данных. Это делает его более безопасным, так как пароль никогда не передается напрямую.

2. **Использование nonce**: Сервер генерирует уникальное значение (nonce), которое используется для создания хэша. Это значение изменяется при каждом запросе, что предотвращает атаки повторного использования (replay attacks).

3. **Хэширование данных**: Клиент и сервер используют хэш-функцию (обычно MD5) для создания хэша на основе логина, пароля, nonce и других параметров. Это позволяет проверить подлинность пользователя без передачи пароля.

## Процесс Digest авторизации

1. **Запрос клиента**: Клиент отправляет запрос на доступ к защищенному ресурсу на сервере.

2. **Ответ сервера**: Сервер отвечает с кодом состояния `401 Unauthorized` и отправляет заголовок `WWW-Authenticate`, который содержит:
   - `realm` — область аутентификации (описание защищенной зоны).
   - `nonce` — уникальное значение, сгенерированное сервером.
   - `qop` — качество защиты (может быть `auth` или `auth-int`).
   - `algorithm` — алгоритм хэширования (обычно `MD5`).

   Пример заголовка:
   ```
   WWW-Authenticate: Digest realm="Protected Area", nonce="abc123", qop="auth", algorithm="MD5"
   ```

3. **Ответ клиента**: Клиент генерирует хэш на основе:
   - Логина пользователя.
   - Пароля.
   - Nonce, полученного от сервера.
   - Метода HTTP-запроса (например, GET или POST).
   - URI запрашиваемого ресурса.
   - Других параметров, таких как `qop` и `cnonce` (клиентское nonce).

   Клиент отправляет заголовок `Authorization` с этими данными:
   ```
   Authorization: Digest username="user", realm="Protected Area", nonce="abc123", uri="/protected", response="<хеш>", qop=auth, nc=00000001, cnonce="xyz456"
   ```

4. **Проверка сервером**: Сервер проверяет хэш, сравнивая его с хэшем, который он сам вычисляет на основе своих данных. Если хэши совпадают, сервер предоставляет доступ к ресурсу.

## Преимущества Digest авторизации

- **Безопасность**: Пароль не передается в открытом виде, что снижает риск его перехвата.
- **Защита от replay-атак**: Использование nonce и счетчика запросов (nc) предотвращает повторное использование перехваченных данных.
- **Поддержка HTTP/1.1**: Digest Auth является частью стандарта HTTP/1.1 и поддерживается большинством веб-серверов и клиентов.

## Недостатки Digest авторизации

- **Сложность реализации**: По сравнению с Basic Auth, Digest Auth требует более сложной реализации как на стороне клиента, так и на стороне сервера.
- **Ограниченная безопасность**: Хотя Digest Auth безопаснее Basic Auth, он все еще уязвим для некоторых атак, таких как атаки методом перебора (brute force), если пароль слабый.
- **Отсутствие поддержки шифрования**: Digest Auth не обеспечивает шифрование данных, передаваемых между клиентом и сервером, поэтому рекомендуется использовать его в сочетании с HTTPS.

## Пример использования

Пример запроса и ответа при использовании Digest авторизации:

1. **Запрос клиента**:
   ```
   GET /protected HTTP/1.1
   Host: example.com
   ```

2. **Ответ сервера**:
   ```
   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Digest realm="Protected Area", nonce="abc123", qop="auth", algorithm="MD5"
   ```

3. **Ответ клиента с авторизацией**:
   ```
   GET /protected HTTP/1.1
   Host: example.com
   Authorization: Digest username="user", realm="Protected Area", nonce="abc123", uri="/protected", response="<хеш>", qop=auth, nc=00000001, cnonce="xyz456"
   ```

4. **Успешный ответ сервера**:
   ```
   HTTP/1.1 200 OK
   Content-Type: text/html
   ```

Для реализации Digest авторизации на TypeScript/JavaScript можно использовать библиотеку `http-auth`, которая упрощает процесс работы с Digest Auth. Ниже приведен пример реализации на сервере и клиенте.

## Пример реализации
### Серверная часть (Node.js + Express)

```typescript
import express from 'express';
import auth from 'http-auth';

const app = express();

// Создаем Digest авторизацию
const digest = auth.digest({
    realm: "Protected Area",
    file: __dirname + "/../data/users.htdigest" // Файл с пользователями и их хэшами
});

// Применяем middleware для аутентификации
app.use(auth.connect(digest));

// Защищенный маршрут
app.get('/', (req, res) => {
    res.send(`Welcome, ${req.user}!`);
});

app.listen(3000, () => {
    console.log('Server is running on port 3000');
});
```

#### Файл `users.htdigest`

Файл `users.htdigest` содержит логины и хэши паролей пользователей. Пример содержимого файла:

```
user1:Protected Area:1a2b3c4d5e6f7g8h9i0j
user2:Protected Area:0j9i8h7g6f5e4d3c2b1a
```

### Клиентская часть (Node.js)

Для отправки запросов с Digest авторизацией можно использовать библиотеку `axios` с поддержкой Digest Auth.

```typescript
import axios from 'axios';
import axiosDigestAuth from '@mhoc/axios-digest-auth';

const digestAuth = new axiosDigestAuth({
    username: 'user1',
    password: 'password1'
});

// Отправляем GET-запрос на защищенный ресурс
digestAuth.request({
    method: 'GET',
    url: 'http://localhost:3000/',
    headers: {
        'Accept': 'application/json'
    }
})
.then(response => {
    console.log(response.data);
})
.catch(error => {
    console.error(error);
});
```

### Объяснение кода

1. **Серверная часть**:
   - Используется библиотека `http-auth` для создания Digest авторизации.
   - Файл `users.htdigest` содержит логины и хэши паролей пользователей.
   - Middleware `auth.connect(digest)` применяется для защиты маршрутов.

2. **Клиентская часть**:
   - Используется библиотека `@mhoc/axios-digest-auth` для отправки запросов с Digest авторизацией.
   - Клиент отправляет GET-запрос на защищенный ресурс, передавая логин и пароль.
