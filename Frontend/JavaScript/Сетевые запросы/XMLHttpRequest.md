
`XMLHttpRequest` это API, который предоставляет клиенту функциональность для обмена данными между клиентом и сервером. Данный API предоставляет простой способ получения данных по ссылке без перезагрузки страницы. Это позволяет обновлять только часть веб-страницы не прерывая пользователя. `XMLHttpRequest используется в AJAX запросах и особенно в single-page приложениях.`

Сам по себе `XMLHttpRequest` – это встроенный в браузер объект, который даёт возможность делать HTTP-запросы к серверу без перезагрузки страницы.

Несмотря на наличие слова «XML» в названии, XMLHttpRequest может работать с любыми данными, а не только с XML. Мы можем загружать/скачивать файлы, отслеживать прогресс и многое другое.

На сегодняшний день не обязательно использовать `XMLHttpRequest`, так как существует другой, более современный метод `fetch`.

В современной веб-разработке `XMLHttpRequest` используется по трём причинам:

1. По историческим причинам: существует много кода, использующего `XMLHttpRequest`, который нужно поддерживать.
2. Необходимость поддерживать старые браузеры и нежелание использовать полифилы (например, чтобы уменьшить количество кода).
3. Потребность в функциональности, которую `fetch` пока что не может предоставить, к примеру, отслеживание прогресса отправки на сервер.

Что-то из этого списка звучит знакомо? Если да, тогда вперёд, приятного знакомства с `XMLHttpRequest`. Если же нет, возможно, имеет смысл изучать сразу [Fetch](https://learn.javascript.ru/fetch).

XMLHttpRequest имеет два режима работы: синхронный и асинхронный.

Сначала рассмотрим асинхронный, так как в большинстве случаев используется именно он.

Чтобы сделать запрос, нам нужно выполнить три шага:

1. Создать `XMLHttpRequest`.
    
	```js
let xhr = new XMLHttpRequest(); // у конструктора нет аргументов
	```
	Конструктор не имеет аргументов.
    
- Инициализировать его.
	    
	```js
xhr.open(method, URL, [async, user, password])
	```
	Этот метод обычно вызывается сразу после `new XMLHttpRequest`. В него передаются основные параметры запроса:
    
    - `method` – HTTP-метод. Обычно это `"GET"` или `"POST"`.
    - `URL` – URL, куда отправляется запрос: строка, может быть и объект [URL](https://learn.javascript.ru/url).
    - `async` – если указать `false`, тогда запрос будет выполнен синхронно, это мы рассмотрим чуть позже.
    - `user`, `password` – логин и пароль для базовой HTTP-авторизации (если требуется).
    
    Заметим, что вызов `open`, вопреки своему названию, не открывает соединение. Он лишь конфигурирует запрос, но непосредственно отсылается запрос только лишь после вызова `send`.
    
- Послать запрос.
	    
	```javascript
xhr.send([body])
	```
	
	Этот метод устанавливает соединение и отсылает запрос к серверу. Необязательный параметр `body` содержит тело запроса.
	
	Некоторые типы запросов, такие как `GET`, не имеют тела. А некоторые, как, например, `POST`, используют `body`, чтобы отправлять данные на сервер. Мы позже увидим примеры.
    
- Слушать события на `xhr`, чтобы получить ответ.
    
    Три наиболее используемых события:
    
    - `load` – происходит, когда получен какой-либо ответ, включая ответы с HTTP-ошибкой, например 404.
    - `error` – когда запрос не может быть выполнен, например, нет соединения или невалидный URL.
    - `progress` – происходит периодически во время загрузки ответа, сообщает о прогрессе.
    

	```javascript
xhr.onload = function() {
  alert(`Загружено: ${xhr.status} ${xhr.response}`);
};

xhr.onerror = function() { // происходит, только когда запрос совсем не получилось выполнить
  alert(`Ошибка соединения`);
};

xhr.onprogress = function(event) { // запускается периодически
  // event.loaded - количество загруженных байт
  // event.lengthComputable = равно true, если сервер присылает заголовок Content-Length
  // event.total - количество байт всего (только если lengthComputable равно true)
  alert(`Загружено ${event.loaded} из ${event.total}`);
};
	```


## Источники
- #### [mdn](https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest)
- #### [learn.js](https://learn.javascript.ru/xmlhttprequest)
