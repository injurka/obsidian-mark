–ï–≥–æ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `Map` –≤ —Ç–æ–º, —á—Ç–æ –∫–ª—é—á–∏ –≤ `WeakMap` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –Ω–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```javascript
let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "ok"); // —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ–±—ä–µ–∫—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞)

// –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞
weakMap.set("test", "Whoops"); // –û—à–∏–±–∫–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ "test" –Ω–µ –æ–±—ä–µ–∫—Ç
```

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –∏ –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –ø–∞–º—è—Ç–∏ (–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ `WeakMap`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

```javascript
let john = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç

// –æ–±—ä–µ–∫—Ç john —É–¥–∞–ª—ë–Ω –∏–∑ –ø–∞–º—è—Ç–∏!
```

–°—Ä–∞–≤–Ω–∏—Ç–µ —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –æ–±—ã—á–Ω–æ–≥–æ `Map`, –ø—Ä–∏–º–µ—Ä –∫–æ—Ç–æ—Ä–æ–≥–æ –±—ã–ª –ø—Ä–∏–≤–µ–¥—ë–Ω —Ä–∞–Ω–µ–µ. –¢–µ–ø–µ—Ä—å `john` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫–ª—é—á –≤ `WeakMap` –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª—ë–Ω –æ—Ç—Ç—É–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

`WeakMap` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–±–æ—Ä –∏ –º–µ—Ç–æ–¥—ã `keys()`, `values()`, `entries()`, —Ç–∞–∫ —á—Ç–æ –Ω–µ—Ç —Å–ø–æ—Å–æ–±–∞ –≤–∑—è—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –Ω–µ—ë.

–í `WeakMap` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Å—Ä–∞–∑—É –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

`WeakMap` ‚Äì —ç—Ç–æ `Map`-–ø–æ–¥–æ–±–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—â–∞—è –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

`WeakMap` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ ¬´–æ—Å–Ω–æ–≤–Ω–æ–º—É¬ª –º–µ—Å—Ç—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫—Ä–æ–º–µ –∫–∞–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –≤ `WeakMap`, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
// üìÅ cache.js
let cache = new WeakMap();

// –≤—ã—á–∏—Å–ª—è–µ–º –∏ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* –≤—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// üìÅ main.js
let obj = {/* –∫–∞–∫–æ–π-—Ç–æ –æ–±—ä–µ–∫—Ç */};

let result1 = process(obj);
let result2 = process(obj);

// ...–ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:
obj = null;

// –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—Ç—å cache.size, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ WeakMap,
// –Ω–æ –æ–Ω —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 0
// –ö–æ–≥–¥–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —É–¥–∞–ª—è–µ—Ç obj, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞ —Ç–æ–∂–µ —É–¥–∞–ª—è—é—Ç—Å—è
```

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏
- #### [learn-ls](https://learn.javascript.ru/map-set)