Данный интерфейс позволяет определять, когда пользователь покидает страницу. Точнее, он вызывает событие при каждом изменении состояния видимости (visibility status) страницы, например, когда пользователь сворачивает/разворачивает окно, переходит на другую вкладку и т.д.

Раньше для этого приходилось прибегать к таким уловкам, как обработка событий `blur` и `focus`. Соответствующий код выглядел так:

```ts
window.addEventListener('blur', () => {
	// пользователь покинул страницу
})

window.addEventListener('focus', () => {
	// пользователь вернулся на страницу
})
```

Приведенный код работает, но не совсем так, как ожидается. Поскольку событие `blur` вызывается, когда страница теряет фокус, оно может возникнуть, когда пользователь нажимает на поиск, диалоговое окно (alert), консоль или границу окна. События `blur` и `focus` сообщают нам о том, что страница активна, но не о том, видим или скрыт ее контент.

## Случаи использования

`Page Visibility API` может использоваться для предотвращения выполнения операций, которые имеют значение, только когда пользователь видит страницу, или для выполнения фоновых операций. Еще несколько кейсов:

- приостановка воспроизведения видео, каруселей изображений (автослайдеров) или анимации, когда пользователь покидает страницу;
- если на странице отображаются данные в реальном времени, нет смысла их обновлять, если пользователь покинул страницу;
- отправка аналитических данных о действиях пользователя.

## Интерфейс
  
`Page Visibility API` предоставляет 2 свойства и одно событие для получения доступа к состоянию видимости страницы:

- `document.hidden` — доступное только для чтения глобальное свойство. Признано устаревшим. Если страница скрыта, возвращается `true`, иначе — `false`;
- `document.visibilityState` — обновленная версия `document.hidden`. Возвращает 4 возможных значения:  
    - `visible` — страница видима или, если быть точнее, страница не свернута и находится в текущей вкладке;
    - `hidden` — страница скрыта;
    - `prerender` — начальное состояние видимой страницы: предварительный рендеринг;
    - `unloaded` — страница выгружена из памяти;
- `visibilitychange` — событие объекта `document`, возникающее при изменении состояния:
```ts
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    // страница видима
  } else {
    // страница скрыта
  }
})
```

## Пример использования

> html
```html
<audio
  controls
  src="https://mdn.github.io/webaudio-examples/audio-basics/outfoxing.mp3"></audio>
```

> ts
```ts
const audio = document.querySelector("audio");

// Handle page visibility change:
// - If the page is hidden, pause the audio
// - If the page is shown, play the audio
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    audio.pause();
  } else {
    audio.play();
  }
});
```


<iframe src="https://caniuse.bitsofco.de/embed/index.html?feat=pagevisibility" frameborder="0" width="100%" height="510px"></iframe>


---

## Источники
- #### [mdn](https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API)
- #### [habr](https://habr.com/ru/companies/timeweb/articles/691992/)