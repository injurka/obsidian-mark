**Рефлексия** - это концепция, при которой программа может анализировать собственное состояние и собирать данные о себе. В Unreal Engine 5 эта концепция реализована через **систему рефлексии**, которая играет ключевую роль в интеграции данных с редактором Unreal Engine, управлении памятью и взаимодействии с Blueprints.

![[{3A66F349-7CCA-4F92-BE8B-29B8F1BDB675}.png]]
## Основные понятия

1. **Макросы рефлексии:**
	* **UClass**:  Представляет класс объекта в Unreal Engine. Он содержит метаданные о классе, такие как свойства, функции, события и т.д.
	* **UProperty**: Представляет свойство класса. Он содержит метаданные о свойстве, такие как тип данных, имя, описание и т.д.
	* **UFunction**: Представляет функцию класса. Он содержит метаданные о функции, такие как параметры, возвращаемое значение и т.д.
	* **UObject**: Базовый класс для всех объектов в Unreal Engine. Он предоставляет базовые функции для работы с рефлексией, такие как доступ к свойствам и функциям.

2. **Unreal Header Tool (UHT):**
	- Программа, которая собирает информацию о классах, переменных и функциях, отмеченных макросами рефлексии (`FILE.generated.h`).
	- Генерирует дополнительный код, который позволяет системе рефлексии получать информацию о классе.

1. **Автоматическое управление памятью:**
	- **Сборка мусора:** Система рефлексии автоматически управляет памятью, удаляя объекты, которые больше не используются.

4. **Взаимодействие с Blueprints:**
	- Переменные и функции, отмеченные макросами рефлексии, могут быть доступны в Blueprints.
	- Это позволяет дизайнерам игр использовать C++ код в визуальном редакторе Blueprints.

## Основные возможности системы рефлексии:

1. **Интроспекция типов:** 
    * Получение информации о классах, структурах, перечислениях и других типах данных.
    * Определение свойств, методов, делегатов, событий и других элементов классов.
2. **Сериализация:**
    * Автоматическая сериализация данных в файлы и обратно.
    * Поддержка различных форматов, таких как JSON, XML и собственный формат Unreal.
3. **Взаимодействие с Blueprints:**
    * Предоставление данных и функциональности C++ классов в Blueprints.
    * Создание пользовательских узлов и компонентов для Blueprints.
4. **Сборка мусора:**
    * Автоматическое управление памятью для объектов, созданных в C++.
    * Обеспечение безопасности при работе с указателями и ссылками.

## Как использовать систему рефлексии

1. **Определение класса**: 
    * Чтобы класс мог использовать систему рефлексии, он должен быть производным от `UObject`.
    * Используйте макросы `UCLASS`, `USTRUCT`, `UENUM`, `UPROPERTY`, `UFUNCTION` для определения класса, структуры, перечисления, свойства и функции соответственно.

Пример:

```cpp
UCLASS()
class MYPROJECT_API AMyActor : public AActor
{
    GENERATED_BODY()

public:
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category="MyCategory")
    int32 MyIntProperty;

    UFUNCTION(BlueprintCallable, Category="MyCategory")
    void MyFunction();
};
```

2. **Доступ к свойствам и функциям**:
    * Используйте функции `GetClass()`, `FindPropertyByName()`, `FindFunctionByName()` для доступа к метаданным класса, свойства и функции соответственно.
    * Используйте функции `GetPropertyValue()`, `SetPropertyValue()`, `ProcessEvent()` для получения, установки значения свойства и вызова функции соответственно.

Пример:

```cpp
void MyFunction(AMyActor* MyActor)
{
    UClass* ActorClass = MyActor->GetClass();
    UProperty* IntProperty = ActorClass->FindPropertyByName(TEXT("MyIntProperty"));

    int32* IntValue = IntProperty->ContainerPtrToValuePtr<int32>(MyActor);
    *IntValue = 42;

    MyActor->MyFunction();
}
```

## Нюансы и советы

* **Производительность**: Система рефлексии может быть медленнее, чем прямой доступ к данным. Используйте ее только там, где это необходимо.
* **Безопасность типов**: Система рефлексии не проверяет типы данных во время компиляции. Будьте осторожны при работе с указателями и приведениями типов.
* **Редактор Unreal Engine**: Система рефлексии тесно интегрирована с редактором Unreal Engine. Она позволяет вам создавать пользовательские интерфейсы, редактировать свойства объектов и многое другое.


